---
- name: Add Elasticsearch YUM repository
  template:
    src: elasticsearch.repo.j2
    dest: /etc/yum.repos.d/elasticsearch.repo
    owner: root
    group: root
    mode: '0644'

- name: Install Elasticsearch
  dnf:
    name: "{{ elasticsearch_package }}"
    enablerepo: elasticsearch
    state: present

- name: Deploy Elasticsearch configuration
  template:
    src: elasticsearch.yml.j2
    dest: /etc/elasticsearch/elasticsearch.yml
    owner: root
    group: elasticsearch
    mode: '0640'
  notify: restart elasticsearch

- name: Reload systemd daemon
  command: systemctl daemon-reload
  notify: restart elasticsearch

- name: Enable and start Elasticsearch service
  systemd:
    name: "{{ elasticsearch_service }}"
    enabled: true
    state: started

- name: Add Kibana YUM repository
  template:
    src: kibana.repo.j2
    dest: /etc/yum.repos.d/kibana.repo
    owner: root
    group: root
    mode: '0644'

- name: Install Kibana
  dnf:
    name: kibana
    state: present

- name: Deploy Kibana configuration
  template:
    src: kibana.yml.j2
    dest: /etc/kibana/kibana.yml
    owner: root
    group: kibana
    mode: '0640'
  notify: restart kibana

- name: Reload systemd daemon
  command: systemctl daemon-reload
  notify: restart kibana

- name: Enable and start Kibana service
  systemd:
    name: kibana
    enabled: true
    state: started

- name: Add Logstash Yum Repository
  yum_repository:
    name: "{{ logstash_repo_name }}"
    description: "Elastic repository for 9.x packages"
    baseurl: "{{ logstash_repo_baseurl }}"
    gpgcheck: yes
    gpgkey: "{{ logstash_repo_gpgkey }}"
    enabled: yes

- name: Install Logstash
  dnf:
    name: logstash
    state: present

- name: Deploy Logstash configuration
  template:
    src: logstash.conf.j2
    dest: "{{ logstash_conf_path }}"
    owner: root
    group: root
    mode: '0644'
  notify: Restart Logstash

- name: Enable and Start Logstash service
  systemd:
    name: "{{ logstash_service }}"
    enabled: yes
    state: started

